<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Cheney Fan's Blog]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="http://fyg.xyjp.net/about/"/>
  <updated>2014-08-10T03:25:58.295Z</updated>
  <id>http://fyg.xyjp.net/about/</id>
  
  <author>
    <name><![CDATA[Cheney Fan]]></name>
    
  </author>
  
  <generator uri="http://zespia.tw/hexo/">Hexo</generator>
  
  <entry>
    <title><![CDATA[test]]></title>
    <link href="http://fyg.xyjp.net/about/2014/08/10/test/"/>
    <id>http://fyg.xyjp.net/about/2014/08/10/test/</id>
    <published>2014-08-10T03:11:10.000Z</published>
    <updated>2014-08-10T03:11:40.000Z</updated>
    <content type="html"><![CDATA[<p>记得以前查过的，今天添加一个博客，又忘了。<br>备注一下吧。</p>
]]></content>
    
    
  </entry>
  
  <entry>
    <title><![CDATA[linux at命令解释及用法]]></title>
    <link href="http://fyg.xyjp.net/about/2014/07/21/linux%E4%B8%ADat%E5%91%BD%E4%BB%A4%E8%A7%A3%E9%87%8A%E5%8F%8A%E7%94%A8%E6%B3%95/"/>
    <id>http://fyg.xyjp.net/about/2014/07/21/linux中at命令解释及用法/</id>
    <published>2014-07-20T23:03:19.000Z</published>
    <updated>2014-07-20T23:21:28.000Z</updated>
    <content type="html"><![CDATA[<p>名称 : at<br>使用权限 : 所有使用者<br>使用方式 : </p>
<pre><code>at <span class="attribute">-V</span> <span class="preprocessor">[</span><span class="attribute">-q</span> <span class="built_in">queue</span><span class="preprocessor">]</span><span class="markup"> </span><span class="preprocessor">[</span><span class="attribute">-f</span> file<span class="preprocessor">]</span><span class="markup"> </span><span class="preprocessor">[</span><span class="attribute">-mldbv</span><span class="preprocessor">]</span><span class="markup"> TIME</span>
</code></pre><p>说明 : at 可以让使用者指定在 TIME 这个特定时刻执行某个程式或指令，TIME 的格式是 HH:MM其中的 HH 为小时，MM 为分钟，甚至你也可以指定 am, pm, midnight, noon, teatime(就是下午 4 点锺)等口语词。<br>如果想要指定超过一天内的时间，则可以用 MMDDYY 或者 MM/DD/YY 的格式，其中 MM 是分钟，DD 是第几日，YY 是指年份。另外，使用者甚至也可以使用像是 now + 时间间隔来弹性指定时间，其中的时间间隔可以是 minutes, hours, days, weeks<br>另外，使用者也可指定 today 或 tomorrow 来表示今天或明天。当指定了时间并按下 enter 之后，at 会进入交谈模式并要求输入指令或程式，当你输入完后按下 ctrl+D 即可完成所有动作，至于执行的结果将会寄回你的帐号中。<br>把计 :<br>-V : 印出版本编号<br>-q : 使用指定的伫列(Queue)来储存，at 的资料是存放在所谓的 queue 中，使用者可以同时使用多个 queue，而 queue 的编号为 a, b, c… z 以及 A, B, … Z 共 52 个<br>-m : 即使程式/指令执行完成后没有输出结果, 也要寄封信给使用者<br>-f file : 读入预先写好的命令档。使用者不一定要使用交谈模式来输入，可以先将所有的指定先写入档案后再一次读入<br>-l : 列出所有的指定 (使用者也可以直接使用 atq 而不用 at -l)<br>-d : 删除指定 (使用者也可以直接使用 atrm 而不用 at -d)<br>-v : 列出所有已经完成但尚未删除的指定</p>
<p>1.例子<br>三天后的下午 5 点锺执行 /bin/ls :</p>
<pre><code><span class="keyword">at</span> <span class="number">5</span>pm + <span class="number">3</span> days /bin/ls
</code></pre><p>三个星期后的下午 5 点锺执行 /bin/ls :</p>
<pre><code><span class="keyword">at</span> <span class="number">5</span>pm + <span class="number">2</span> weeks /bin/ls
</code></pre><p>明天的 17:20 执行 /bin/date :</p>
<pre><code><span class="keyword">at</span> <span class="number">17</span>:<span class="number">20</span> tomorrow /bin/<span class="built_in">date</span>
</code></pre><p>1999 年的最后一天的最后一分钟印出 the end of world !</p>
<pre><code><span class="keyword">at</span> <span class="number">23</span>:<span class="number">59</span> <span class="number">12</span>/<span class="number">31</span>/<span class="number">1999</span> echo <span class="operator">the</span> <span class="function"><span class="keyword">end</span> <span class="title">of</span> <span class="title">world</span> !</span>
</code></pre><p>在明天的2：05执行airplane脚本</p>
<pre><code><span class="comment"># at 2:05 tomorrow </span>
       at&gt; <span class="regexp">/home/mj</span><span class="regexp">/airplane &gt; /home</span><span class="regexp">/mj/air</span>-safe 
       at&gt; <span class="constant">Ctrl</span>+<span class="constant">D</span>
</code></pre><p>2.查看目前在等待执行的任务<br>输入任务后，可以使用atq命令可以看到目前等待执行的任务，输出提供了任务号、用户和任务执行时间等信息。 </p>
<pre><code><span class="preprocessor"># atq </span>
<span class="number">8</span> <span class="number">2012</span>-<span class="number">11</span>-<span class="number">15</span> <span class="number">02</span>:<span class="number">05</span> a mj 
</code></pre><p>里面的a表示是at任务还是batch命令生成的任务。<br>3.删除at任务<br>删除一个at任务比较简单，使用atrm命令就可以轻松解决。<br>比如我知道了任务的队列号，那么就可以删除它： </p>
<pre><code><span class="preprocessor"># atm 8</span>
</code></pre><p>就删除了队列号为8的at任务了。 </p>
<pre><code><span class="keyword">at</span> -l<span class="comment"> //列表 </span>
<span class="keyword">at</span> -r<span class="comment"> //移除</span>
</code></pre>]]></content>
    
    
      <category term="linux" scheme="http://fyg.xyjp.net/about/tags/linux/"/>
    
      <category term="Develop" scheme="http://fyg.xyjp.net/about/categories/Develop/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[VBA连接SAP]]></title>
    <link href="http://fyg.xyjp.net/about/2014/07/19/vba%E8%BF%9E%E6%8E%A5sap/"/>
    <id>http://fyg.xyjp.net/about/2014/07/19/vba连接sap/</id>
    <published>2014-07-19T14:37:53.000Z</published>
    <updated>2014-07-19T15:24:34.000Z</updated>
    <content type="html"><![CDATA[<p>折腾了好久才搞定。<br>步骤：<br>1.在sap中建立自定义函数，将该函数设置为远程调用<br>    ①建立函数组<br><img src="http://picforxyjp.qiniudn.com/%E3%82%AD%E3%83%A3%E3%83%97%E3%83%81%E3%83%A3.PNG" alt="priceType.sap"><br>    ②建立函数，将该函数与建立的函数组关联。设置函数为远程调用函数。<br><img src="http://picforxyjp.qiniudn.com/vbaToSap2.PNG" alt="priceType.sap"><br>    ③设置接受参数。其中ZFYG_CUST_LIST为自定义类型，需要自己建立。<br><img src="http://picforxyjp.qiniudn.com/vbaToSap3.PNG" alt="priceType.sap"><br>    ③在se11中建立自定义类型，并激活。<br><img src="http://picforxyjp.qiniudn.com/vbaToSap5.PNG" alt="priceType.sap"><br><img src="http://picforxyjp.qiniudn.com/vbaToSap4.PNG" alt="priceType.sap"><br>    ③自定义函数中输入代码。<br><img src="http://picforxyjp.qiniudn.com/vbaToSap6.PNG" alt="priceType.sap"></p>
<pre><code>FUNCTION ZFYG2_GET_CUSTOMER_DETAILS.
*"<span class="comment">----------------------------------------------------------------------</span>
*"*"ローカルインタフェース:
*"  TABLES
*"      ET_KUNNR STRUCTURE  SHP_KUNNR_RANGE OPTIONAL
*"      ET_CUST_LIST STRUCTURE  ZFYG_CUST_LIST OPTIONAL
*"<span class="comment">----------------------------------------------------------------------</span>
  IF NOT ET_KUNNR[] IS INITIAL.

    <span class="operator"><span class="keyword">SELECT</span> KUNNR
                LAND1
                NAME1
                ORT01
                PSTLZ
                REGIO
                KTOKD
                TELF1
                TELFX
      <span class="keyword">INTO</span> <span class="keyword">TABLE</span> et_cust_list
      <span class="keyword">FROM</span> kna1
      <span class="keyword">WHERE</span> kunnr <span class="keyword">IN</span> et_kunnr.

      <span class="keyword">IF</span> sy-subrc &lt;&gt; <span class="number">0.</span>
        CLEAR: et_cust_list.
      ENDIF.

  ENDIF.
ENDFUNCTION.</span>
</code></pre><p>⑤激活函数。激活时注意要选择函数组一起激活，否则会出现错误。<br>2.通过VBA调用函数<br>    包括两步，①用户验证，③调用函数。以下是代码：<br>    Option Explicit<br>    Sub saplogin()</p>
<pre><code><span class="keyword">Dim</span> oBapiLogon <span class="keyword">As</span> <span class="built_in">Object</span>
<span class="comment">'Dim oBapiCtrl As SAPLogonCtrl.SAPLogonControl</span>
<span class="keyword">Dim</span> oBapiCtrl <span class="keyword">As</span> <span class="built_in">Object</span>
<span class="keyword">Dim</span> objgetaddress <span class="keyword">As</span> <span class="built_in">Object</span>
<span class="comment">'Dim ojbkunnr As SAPTableFactoryCtrl.Table</span>
<span class="keyword">Dim</span> objkunnr <span class="keyword">As</span> <span class="built_in">Object</span>
<span class="keyword">Dim</span> objaddress <span class="keyword">As</span> <span class="built_in">Object</span>
<span class="keyword">Dim</span> vcount_add, index_add, vRows <span class="keyword">As</span> <span class="built_in">Integer</span>

<span class="keyword">Set</span> oBapiLogon = CreateObject(<span class="string">"sap.logoncontrol.1"</span>)
<span class="comment">'Set oBapiCtrl = CreateObject("sap.bapi.1")</span>
<span class="keyword">Set</span> oBapiCtrl = CreateObject(<span class="string">"SAP.Functions"</span>)

oBapiCtrl.Connection = oBapiLogon.NewConnection
oBapiCtrl.Connection.ApplicationServer = <span class="string">"10.10.10.11"</span>
oBapiCtrl.Connection.System = <span class="string">"KMY"</span>
oBapiCtrl.Connection.Client = <span class="string">"4000"</span>
oBapiCtrl.Connection.User = <span class="string">"USERID"</span>
oBapiCtrl.Connection.Password = <span class="string">"PASSWORD"</span>
oBapiCtrl.Connection.Language = <span class="string">"JA"</span>
oBapiCtrl.Connection.SystemNumber = <span class="string">"00"</span>
oBapiCtrl.Connection.SAPRouter = <span class="string">"SAPROUTER"</span>


<span class="keyword">If</span> oBapiCtrl.Connection.Logon(<span class="number">0</span>, <span class="literal">True</span>) &lt;&gt; <span class="literal">True</span> <span class="keyword">Then</span>
    MsgBox <span class="string">"not connected"</span>, vbInformation, <span class="string">"Sap Logon"</span>: <span class="keyword">Exit</span> <span class="keyword">Sub</span>
<span class="keyword">End</span> <span class="keyword">If</span>

<span class="keyword">Set</span> objgetaddress = oBapiCtrl.Add(<span class="string">"ZFYG2_GET_CUSTOMER_DETAILS"</span>)
<span class="keyword">Set</span> objkunnr = objgetaddress.Tables(<span class="string">"ET_KUNNR"</span>)
<span class="keyword">Set</span> objaddress = objgetaddress.Tables(<span class="string">"ET_CUST_LIST"</span>)


<span class="keyword">If</span> ThisWorkbook.ActiveSheet.Cells(<span class="number">6</span>, <span class="string">"B"</span>).Value &lt;&gt; <span class="string">""</span> <span class="keyword">Then</span>
    objkunnr.Rows.Add
    objkunnr.Value(<span class="number">1</span>, <span class="string">"SIGN"</span>) = ThisWorkbook.ActiveSheet.Cells(<span class="number">6</span>, <span class="number">2</span>).Value
    objkunnr.Value(<span class="number">1</span>, <span class="string">"OPTION"</span>) = ThisWorkbook.ActiveSheet.Cells(<span class="number">6</span>, <span class="number">3</span>).Value
    objkunnr.Value(<span class="number">1</span>, <span class="string">"LOW"</span>) = ThisWorkbook.ActiveSheet.Cells(<span class="number">6</span>, <span class="number">4</span>).Value
    objkunnr.Value(<span class="number">1</span>, <span class="string">"HIGH"</span>) = ThisWorkbook.ActiveSheet.Cells(<span class="number">6</span>, <span class="number">5</span>).Value

<span class="keyword">End</span> <span class="keyword">If</span>


objgetaddress.<span class="keyword">call</span>

  vcount_add = objaddress.Rows.Count
    <span class="keyword">For</span> index_add = <span class="number">1</span> <span class="keyword">To</span> vcount_add
      vRows = <span class="number">11</span> + index_add
      ActiveSheet.Cells(vRows, <span class="number">2</span>) = objaddress.Value(index_add, <span class="string">"KUNNR"</span>)
      ActiveSheet.Cells(vRows, <span class="number">3</span>) = objaddress.Value(index_add, <span class="string">"LAND1"</span>)
      ActiveSheet.Cells(vRows, <span class="number">4</span>) = objaddress.Value(index_add, <span class="string">"NAME1"</span>)
      ActiveSheet.Cells(vRows, <span class="number">5</span>) = objaddress.Value(index_add, <span class="string">"ORT01"</span>)
      ActiveSheet.Cells(vRows, <span class="number">6</span>) = objaddress.Value(index_add, <span class="string">"PSTLZ"</span>)
      ActiveSheet.Cells(vRows, <span class="number">7</span>) = objaddress.Value(index_add, <span class="string">"REGIO"</span>)
      ActiveSheet.Cells(vRows, <span class="number">8</span>) = objaddress.Value(index_add, <span class="string">"KTOKD"</span>)
      ActiveSheet.Cells(vRows, <span class="number">9</span>) = objaddress.Value(index_add, <span class="string">"TELF1"</span>)
      ActiveSheet.Cells(vRows, <span class="number">10</span>) = objaddress.Value(index_add, <span class="string">"TELFX"</span>)
    <span class="keyword">Next</span> index_add
  <span class="comment">'If address not exist then show error</span>
  <span class="keyword">If</span> vcount_add = <span class="string">""</span> <span class="keyword">Then</span>
    ActiveSheet.Cells(<span class="number">10</span>, <span class="number">11</span>) = <span class="string">"Invalid Input"</span>
  <span class="keyword">Else</span>
    ActiveSheet.Cells(<span class="number">10</span>, <span class="number">12</span>) = <span class="string">"BAPI Call is successfull"</span>
    ActiveSheet.Cells(<span class="number">11</span>, <span class="number">12</span>) = vcount_add &amp; <span class="string">" rows are returned"</span>
  <span class="keyword">End</span> <span class="keyword">If</span>

  oBapiCtrl.Connection.Logoff


<span class="keyword">End</span> <span class="keyword">Sub</span>
</code></pre><p>以下是EXCEL。通过点击执行按钮后获取客户信息。<br><img src="http://picforxyjp.qiniudn.com/vbaToSap7.PNG" alt="priceType.sap"></p>
]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[价格计算过程中的小计]]></title>
    <link href="http://fyg.xyjp.net/about/2014/07/10/%E4%BB%B7%E6%A0%BC%E8%AE%A1%E7%AE%97%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%B0%8F%E8%AE%A1/"/>
    <id>http://fyg.xyjp.net/about/2014/07/10/价格计算过程中的小计/</id>
    <published>2014-07-10T14:34:41.000Z</published>
    <updated>2014-07-10T15:18:14.000Z</updated>
    <content type="html"><![CDATA[<p>在价格计算过程中根据需要更改小计的业务逻辑。<br>位置：SAPLV61A program  FORM XKOMV_BEWERTEN (Include LV61AA55):</p>
<pre><code>* L O O P
LOOP AT xkomv.
    <span class="keyword">...</span>
    * calculate subtotals <span class="keyword">in</span> KOMP
    IF xkomv-kinak <span class="literal">NA</span> <span class="string">'AKLMXZ'</span>.
        <span class="keyword">...</span>
        * fill subtotal work fields
        CASE xkomv-kzwiw.        &lt;== The setting <span class="keyword">for</span> KZWIW
            WHEN <span class="string">' '</span>.                  is checked <span class="keyword">in</span> this
            WHEN <span class="string">'A'</span>. CASE statement.
            <span class="keyword">...</span>
            WHEN <span class="string">'B'</span>.
            <span class="keyword">...</span>
             WHEN <span class="string">'1'</span>.
*{   REPLACE        自己添加的逻辑，在category为<span class="number">5</span>的时候，把基础值传入累积数                                        <span class="number">1</span>
*\          ADD xkomv-kwert TO komp-kzwi1.
          IF xkomv-kntyp EQ <span class="string">'5'</span>.
            ADD xkomv-kawrt TO komp-kzwi1.
          ELSE.
            ADD xkomv-kwert TO komp-kzwi1.
          ENDIF.
*}   REPLACE
            WHEN <span class="keyword">...</span>
            <span class="keyword">...</span>
        ENDCASE.
        <span class="keyword">...</span>
    ENDIF.
    <span class="keyword">...</span>
* L O O P
ENDLOOP.
</code></pre>]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[配置的条件类型的Calculation type]]></title>
    <link href="http://fyg.xyjp.net/about/2014/07/10/%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E6%9D%A1%E4%BB%B6%E7%B1%BB%E5%9E%8B%E7%9A%84%E8%AE%A1%E7%AE%97%E7%B1%BB%E5%88%AB/"/>
    <id>http://fyg.xyjp.net/about/2014/07/10/创建自己的条件类型的计算类别/</id>
    <published>2014-07-10T13:49:37.000Z</published>
    <updated>2014-07-10T14:18:20.000Z</updated>
    <content type="html"><![CDATA[<p>条件类型中有Calculation type选项，根据选择不同，计算方式也不同。那么我们可不可以创建自己的Calculation type呢？答案是否定的，我们无法添加新的Calculation type。<br>但是我们可以通过其他方式配置出自己需要的计算类别。<br>首先，配置条件的category。<br><img src="http://i1066.photobucket.com/albums/u414/xiazhiyu/30AD30E330D730C130E3_zps817d6d7a.png" alt="priceType.sap"><br>在EXIT进行计算逻辑的修改form xkomv_kwert_ermitteln(程序：LV61AA43)</p>
<pre><code>//*标准程序中根据Calculation type进行不同的计算处理。
    CASE xkomv-krech.
        WHEN <span class="string">' '</span>.
            arbfeld     = zwisu.
          WHEN <span class="string">'A'</span>.
        WHEN <span class="string">'B'</span> OR <span class="string">'T'</span>.
          <span class="keyword">...</span>
        WHEN <span class="string">'H'</span>.
          <span class="keyword">...</span>
        WHEN <span class="string">'I'</span>.
          <span class="keyword">...</span>
        WHEN <span class="string">'J'</span>.  //Promille
          <span class="keyword">...</span>
        WHEN <span class="string">'K'</span>.  //Promille im Tausend
          <span class="keyword">...</span>
        WHEN OTHERS.

*{   REPLACE        添加自己的业务逻辑
*\        arbfeld     = xkomv-kawrt * xkbetr / xkomv-kpein.
        IF xkomv-kntyp EQ <span class="string">'5'</span> AND xkomv-krech EQ <span class="string">'C'</span>.  //判断是否属于自己配置的条件category
          arbfeld  = xkomv-kawrt * KOMP-MGAME.
        ELSE.
          arbfeld     = xkomv-kawrt * xkbetr / xkomv-kpein.
          IF NOT xkomv-kfaktor IS INITIAL.
            arbfeld = arbfeld * xkomv-kfaktor.
          ENDIF.
          IF NOT xkomv-kfaktor1 IS INITIAL.
            arbfeld = arbfeld * xkomv-kfaktor1.
          ENDIF.
        ENDIF.

*}   REPLACE

          <span class="keyword">...</span>

    ENDCASE.
</code></pre>]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[读取条件记录 CONDITION_RECORD_READ]]></title>
    <link href="http://fyg.xyjp.net/about/2014/06/29/%E8%AF%BB%E5%8F%96%E6%9D%A1%E4%BB%B6%E8%AE%B0%E5%BD%95function(CONDITION_RECORD_READ)/"/>
    <id>http://fyg.xyjp.net/about/2014/06/29/读取条件记录function(CONDITION_RECORD_READ)/</id>
    <published>2014-06-29T07:56:03.000Z</published>
    <updated>2014-06-29T08:14:30.000Z</updated>
    <content type="html"><![CDATA[<p>碰到这样的用例：在SO价格计算过程中，当条件b中有条件记录的数据时，条件a无效并且不予显示。原本可以简单些，直接使用排除条件，当b有数据时a设置为无效。但这样一个黄色的无效条件出现出现在价格表中总有点合适。关键这样的话，无法对a进行必须设置，即当b中没有数据时a必须有数据；但如果b有数据时则a为非必须。</p>
<p>最好的方式是使用限定条件。在a的限定条件下设置一个routine，代码如下：</p>
<pre><code>    <span class="built_in">DATA</span> PE_I_VAKE LIKE  VAKEKOND<span class="built_in">.</span>
    call function <span class="string">'CONDITION_RECORD_READ'</span>
         exporting
              pi_kvewe      <span class="subst">=</span> <span class="string">'A'</span>
              pi_kappl        <span class="subst">=</span> <span class="string">'V'</span>
              pi_kschl        <span class="subst">=</span> <span class="string">'VAF1'</span>     <span class="string">"判断条件VAF1是否存在数据
              pi_i_komk       = komk
              pi_i_komp       = komp
         importing
              pe_i_vake       = pe_i_vake
         exceptions
              no_record_found = 1
              others          = 2.
    IF sy-subrc NE 0 OR pe_i_vake-kbetr EQ 0."</span>当不为<span class="number">0</span>时即有数据
      komp<span class="attribute">-ztest</span> <span class="subst">=</span> <span class="string">'t'</span><span class="built_in">.</span>
    ENDIF<span class="built_in">.</span>
    sy<span class="attribute">-subrc</span> <span class="subst">=</span> <span class="number">4.</span>
      check: komp<span class="attribute">-ztest</span> ne <span class="string">'t'</span><span class="built_in">.</span>
    sy<span class="attribute">-subrc</span> <span class="subst">=</span> <span class="number">0.</span>
</code></pre>]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[sap订单(发票)复制时的价格拷贝类型]]></title>
    <link href="http://fyg.xyjp.net/about/2014/06/28/%E5%8F%91%E7%A5%A8%E5%A4%8D%E5%88%B6%E6%97%B6%E7%9A%84%E4%BB%B7%E6%A0%BC%E7%B1%BB%E5%9E%8B/"/>
    <id>http://fyg.xyjp.net/about/2014/06/28/发票复制时的价格类型/</id>
    <published>2014-06-28T02:18:18.000Z</published>
    <updated>2014-06-28T06:02:14.000Z</updated>
    <content type="html"><![CDATA[<p>详细参考sap note 24832.<br>sap在根据出货单生成发票（或者其他订单复制）时，是直接复制金额，还是直接重新根据条件类型的金额重新计算，可以在拷贝规则里进行设置。</p>
<p><img src="http://i1066.photobucket.com/albums/u414/xiazhiyu/65B03057304430D330C330C830DE30C330D730A430E130FC30B8_zpsd12a5fda.png" alt="priceType.sap"></p>
<p>系统标准已存在A,B,C,…等类型，但你依然可以根据需要自己定制。</p>
<p>首先需要RV61AFZA的用户出口USEREXIT_PRICING_RULE中类似代码，以扩展价格类型。</p>
<pre><code>FORM USEREXIT_PRICING_RULE
  STEU<span class="attribute">-KNPRS</span> <span class="subst">=</span> <span class="string">'X'</span><span class="built_in">.</span>
  STEU<span class="attribute">-KNTYP</span> <span class="subst">=</span> <span class="string">'LRIE......'</span><span class="built_in">.</span>
  <span class="keyword">IF</span> KOMK<span class="attribute">-KNUMA</span> IS INITIAL<span class="built_in">.</span>
    STEU<span class="attribute">-KOAID</span> <span class="subst">=</span> <span class="string">'CD........'</span><span class="built_in">.</span>
  <span class="keyword">ELSE</span><span class="built_in">.</span>
    STEU<span class="attribute">-KOAID</span> <span class="subst">=</span> <span class="string">'D.........'</span><span class="built_in">.</span>
  ENDIF<span class="built_in">.</span>  STEU<span class="attribute">-MAUEB</span> <span class="subst">=</span> <span class="string">' '</span><span class="built_in">.</span>
  APPEND STEU<span class="built_in">.</span> 
ENDFORM<span class="built_in">.</span>
</code></pre><p>系统将会根据条件类型的codition  class, codition category 等判断是否重新计算。</p>
<p><img src="http://i1066.photobucket.com/albums/u414/xiazhiyu/30AD30E330D730C130E3_zps0f6981a1.png" alt="priceType.sap"></p>
<p>o KNPRS<br>表示给价格类型<br>o KNTYP<br>需要重新计算的codition category（最多添加10个）.<br>o KOAID<br>需要重新计算的codition class（最多添加10个）.<br>o MAUEB<br>是否拷贝手动修改的条件类型.<br>o STFKZ<br>This field contains a positive list of the scale indicators (最多添加5个）</p>
<p>…</p>
]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[SD--对于定价过程参考步骤 (Condition Step)(T683S-STUNB and T683S-STUN2)]]></title>
    <link href="http://fyg.xyjp.net/about/2014/06/28/condition-step/"/>
    <id>http://fyg.xyjp.net/about/2014/06/28/condition-step/</id>
    <published>2014-06-27T18:28:25.000Z</published>
    <updated>2014-06-27T18:42:28.000Z</updated>
    <content type="html"><![CDATA[<p><em>1)概述</em></p>
<p>对于参考步骤 (Condition Step)(T683S-STUNB and T683S-STUN2)的使用代码分析<br>SAP对定价过程中的从参考步骤(T683S-STUNB)和到参考步骤T683S-STUN2)的使用分两种情况：无条件类型的小计项目和有条件计算项目。<br>在LV61AA55单元会根据定价过程生成的xkomv内表来循环计算各项值;<br>    *LOOP:<br>      loop at xkomv.</p>
<pre><code><span class="subst">*</span> calculate condition basis(有条件计算项目)，(<span class="number">162</span>行),调用konditionsbasis_ermitteln子过程填写kawrt(条件基值),供后续项目计算使用
          perform konditionsbasis_ermitteln<span class="built_in">.</span>

<span class="subst">*</span> scale basis changed <span class="literal">or</span> <span class="number">0</span>
<span class="subst">*</span> KON<span class="attribute">-KBETR</span> should <span class="literal">not</span> be there <span class="keyword">if</span> scale basis is <span class="number">0</span>
             ( ( xkstbs ne ykstbs ) <span class="literal">or</span> xkstbs <span class="literal">eq</span> <span class="number">0</span> ) <span class="literal">and</span>
             xkomv<span class="attribute">-kmprs</span> is initial   <span class="literal">and</span>
             xkomv<span class="attribute">-ksteu</span> <span class="literal">eq</span> <span class="string">'A'</span><span class="built_in">.</span>
            perform xkomv_kbetr_aus_staffel<span class="built_in">.</span>
          endif<span class="built_in">.</span>
          <span class="keyword">if</span> xkomv<span class="attribute">-krech</span> na absolute <span class="literal">or</span> xkomv<span class="attribute">-kgrpe</span> ne <span class="string">'X'</span><span class="built_in">.</span>
            perform xkomv_kwert_ermitteln<span class="built_in">.</span>
          endif<span class="built_in">.</span>
        endif<span class="built_in">.</span>
      <span class="keyword">else</span><span class="built_in">.</span>
        <span class="keyword">if</span> xkomv<span class="attribute">-kschl</span> <span class="literal">eq</span> space<span class="built_in">.</span>
<span class="subst">*</span>(无条件类型的小计项目),调用xkomv_kwert_ermitteln子过程直接将汇总填写到小计项目的kwert字段
          perform xkomv_kwert_ermitteln<span class="built_in">.</span>
        endif<span class="built_in">.</span>
      endif<span class="built_in">.</span>
<span class="attribute">...</span><span class="built_in">..</span>
endloop<span class="built_in">.</span>
</code></pre><p><em>2)无条件类型的小计项目计算代码分析</em><br>xkomv_kwert_ermitteln代码参见单元LV61AA43的下列代码，这段代码会调用子过程xkomv_kawrt_ermitteln将相应定价项目的字段(kwert)汇总填写到小计项目的kwert字段，参见红色部分。<br>    FORM xkomv_kwert_ermitteln.<br>      DATA: xkbetr(16) TYPE p DECIMALS 2.<br>      DATA: cond_curr_is_euro, doc_curr_is_euro.</p>
<pre><code><span class="subst">*</span> <span class="keyword">sum</span> line owning reference step
  <span class="keyword">IF</span> xkomv<span class="attribute">-kschl</span> <span class="subst">=</span> space <span class="literal">AND</span> xkomv<span class="attribute">-stunb</span> NE <span class="number">0.</span>
    CATCH SYSTEM<span class="attribute">-EXCEPTIONS</span> conversion_errors <span class="subst">=</span> <span class="number">1</span>
                            arithmetic_errors <span class="subst">=</span> <span class="number">5.</span>
      PERFORM xkomv_kawrt_ermitteln<span class="built_in">.</span>
      xkomv<span class="attribute">-kwert</span> <span class="subst">=</span> xkawrt<span class="built_in">.</span>
    ENDCATCH<span class="built_in">.</span>
    <span class="keyword">IF</span> sy<span class="attribute">-subrc</span> <span class="subst">=</span> <span class="number">1</span> <span class="literal">OR</span> sy<span class="attribute">-subrc</span> <span class="subst">=</span> <span class="number">5.</span>
      MESSAGE s802<span class="built_in">.</span>
      xkomv<span class="attribute">-kinak</span> <span class="subst">=</span> <span class="string">'X'</span><span class="built_in">.</span>
      xkomv<span class="attribute">-kwert</span> <span class="subst">=</span> <span class="number">0.</span>
      xkomv<span class="attribute">-fxmsg</span> <span class="subst">=</span> <span class="string">'802'</span><span class="built_in">.</span>
      komp<span class="attribute">-fxmsg</span>  <span class="subst">=</span> <span class="string">'802'</span><span class="built_in">.</span>
    ENDIF<span class="built_in">.</span>
<span class="subst">*</span> no calculation for KDUPL conditions because condition value is
<span class="subst">*</span> calculated <span class="keyword">by</span> formula <span class="number">36.</span>
  ELSEIF xkomv<span class="attribute">-kdupl</span> NE <span class="string">'B'</span><span class="built_in">.</span>
</code></pre><p><em>3)有条件计算项目代码分析</em><br>konditionsbasis_ermitteln代码参见单元LV61AA74的下列代码，这段代码会调用子过程xkomv_kawrt_ermitteln将相应定价项目的字段(kwert)汇总填写到小计项目的kawrt(条件基值),参见红色部分。<br>    form konditionsbasis_ermitteln.<br>      data: da_xxmglme like komp-brgew,<br>            da_xxmeins like komp-gewei,<br>            da_fxmsg   like xkomv-fxmsg.<br>      data: arbfeld_dec(16) type p decimals 3.<br>      xkomv-kawrt = 0.<br>      if xkomv-krech ca prz_abs and not xkomv-krech = ‘T’.<br>        if xkomv-stunb ne 0 or xkomv-stun2 ne 0 or xkomv-koaid = ‘D’.<br>          perform xkomv_kawrt_ermitteln.<br>          xkomv-kawrt = xkawrt.<br>        endif.<br>        if xkomv-stunb = 0 and xkomv-stun2 = 0.<br>          xkomv-kawrt = zwisu.<br>        endif.<br>      endif.</p>
<p><em>4)循环合计子过程代码的摘抄，参见红色部分</em></p>
<pre><code>form xkomv_kawrt_ermitteln<span class="built_in">.</span>

  <span class="built_in">data</span>:  axkomv like komv<span class="built_in">.</span>

<span class="subst">*</span> assign <span class="subst">&amp;</span> initialize
  axkomv <span class="subst">=</span> xkomv<span class="built_in">.</span>
  xkawrt <span class="subst">=</span> <span class="number">0.</span>

<span class="subst">*</span> <span class="built_in">set</span> from <span class="subst">-</span> <span class="keyword">to</span> step number comming form pricing procedure<span class="subst">!</span>
  xstunr <span class="subst">=</span> xkomv<span class="attribute">-stunb</span><span class="built_in">.</span>
  xstun2 <span class="subst">=</span> xkomv<span class="attribute">-stun2</span><span class="built_in">.</span>
  <span class="keyword">if</span> xstun2 <span class="literal">lt</span> xstunr<span class="built_in">.</span>
    xstun2 <span class="subst">=</span> xstunr<span class="built_in">.</span>
  endif<span class="built_in">.</span>
  <span class="keyword">if</span> xstun2 <span class="subst">=</span> <span class="number">0.7</span>
    xstun2 <span class="subst">=</span> xkomv<span class="attribute">-stunr</span><span class="built_in">.</span>
  endif<span class="built_in">.</span>

<span class="subst">*</span> build up key <span class="keyword">to</span> read XKOMV table
  komv_key<span class="attribute">-mandt</span> <span class="subst">=</span> komk<span class="attribute">-mandt</span><span class="built_in">.</span>
  komv_key<span class="attribute">-knumv</span> <span class="subst">=</span> komk<span class="attribute">-knumv</span><span class="built_in">.</span>
  komv_key<span class="attribute">-kposn</span> <span class="subst">=</span> komp<span class="attribute">-kposn</span><span class="built_in">.</span>
  komv_key<span class="attribute">-stunr</span> <span class="subst">=</span> xstunr<span class="built_in">.</span>
  komv_key<span class="attribute">-zaehk</span> <span class="subst">=</span> <span class="number">0.</span>
  read table xkomv <span class="keyword">with</span> key komv_key binary search<span class="built_in">.</span>
  <span class="keyword">if</span> sy<span class="attribute">-subrc</span> <span class="literal">lt</span> <span class="number">8.</span>
    read table xkomv index sy<span class="attribute">-tabix</span><span class="built_in">.</span>
    <span class="keyword">if</span> xkomv<span class="attribute">-stunr</span> <span class="literal">gt</span> xstun2<span class="built_in">.</span>
      read table xkomv index xkomv_tabix<span class="built_in">.</span>
      xkomv <span class="subst">=</span> axkomv<span class="built_in">.</span>
      exit<span class="built_in">.</span>
    <span class="keyword">else</span><span class="built_in">.</span>
      <span class="keyword">loop</span> at xkomv<span class="built_in">.</span>
        <span class="keyword">if</span> xkomv<span class="attribute">-stunr</span> <span class="literal">gt</span> xstun2 <span class="literal">or</span> sy<span class="attribute">-tabix</span> <span class="subst">=</span> xkomv_tabix<span class="built_in">.</span>
          read table xkomv index xkomv_tabix<span class="built_in">.</span>
          xkomv <span class="subst">=</span> axkomv<span class="built_in">.</span>
          exit<span class="built_in">.</span>
        endif<span class="built_in">.</span>
        <span class="keyword">if</span> ( xkomv<span class="attribute">-stunr</span> ge xstunr <span class="literal">and</span> xkomv<span class="attribute">-stunr</span> le xstun2 )  <span class="literal">and</span>
             xkomv<span class="attribute">-kinak</span> na <span class="string">'AKLMX'</span><span class="built_in">.</span>
          add xkomv<span class="attribute">-kwert</span> <span class="keyword">to</span> xkawrt<span class="built_in">.</span>
        endif<span class="built_in">.</span>
      endloop<span class="built_in">.</span>
    endif<span class="built_in">.</span>
  endif<span class="built_in">.</span>

  <span class="keyword">if</span> xkomv_tabix ne <span class="number">0.</span>
    read table xkomv index xkomv_tabix<span class="built_in">.</span>
  endif<span class="built_in">.</span>
  xkomv <span class="subst">=</span> axkomv<span class="built_in">.</span>
endform<span class="built_in">.</span>
</code></pre>]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[javascript导出csv文件]]></title>
    <link href="http://fyg.xyjp.net/about/2014/04/29/javascript%E5%AF%BC%E5%87%BAcsv%E6%96%87%E4%BB%B6/"/>
    <id>http://fyg.xyjp.net/about/2014/04/29/javascript导出csv文件/</id>
    <published>2014-04-29T14:16:12.000Z</published>
    <updated>2014-06-27T14:32:28.000Z</updated>
    <content type="html"><![CDATA[<p>CSV输出通常做法是后台输出文件，再通过浏览器下载。但是其实也可以通过javascript直接在前端完成，减轻服务器负担。<br>只是浏览器兼容让人头疼。<br>目前方案，chrome，firefox，IE10+通过。代码如下：</p>
<pre><code><span class="keyword">var</span> json2csv = <span class="function"><span class="keyword">function</span> <span class="params">(objArray, target, fileName)</span> {</span>
   <span class="comment">// var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;</span>
    <span class="comment">//var array =</span>
    <span class="keyword">var</span> array = <span class="keyword">typeof</span> objArray != <span class="string">'object'</span> ? angular.toJson(objArray) : objArray;  <span class="comment">//这里有段angularjs代码，请酌情修改</span>
    <span class="keyword">var</span> str = <span class="string">'\ufeff'</span>;  <span class="comment">//对应含bom的utf8文件</span>
    <span class="keyword">var</span> line = <span class="string">''</span>;
    <span class="keyword">var</span> changeLine = <span class="string">'\r\n'</span>;
    <span class="keyword">if</span>(IEV==-<span class="number">1</span>)changeLine= <span class="built_in">escape</span>(changeLine);   <span class="comment">//IEV是这里IE版本号，－1表示非IE浏览器。因为换行符在两个处理方法上存在差异。</span>
    <span class="keyword">if</span> ($(<span class="string">"#labels"</span>).is(<span class="string">':checked'</span>)) {
        <span class="keyword">var</span> head = array[<span class="number">0</span>];
        <span class="keyword">if</span> ($(<span class="string">"#quote"</span>).is(<span class="string">':checked'</span>)) {
            <span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> array[<span class="number">0</span>]) {
                <span class="keyword">var</span> value = index + <span class="string">""</span>;
                line += <span class="string">'"'</span> + value.replace(<span class="regexp">/"/g</span>, <span class="string">'""'</span>) + <span class="string">'",'</span>;
            }
        }

         <span class="keyword">else</span> {
            <span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> array[<span class="number">0</span>]) {
                line += index + <span class="string">','</span>;
            }
        }

        line = line.slice(<span class="number">0</span>, -<span class="number">1</span>);
        str += line + changeLine;
    }

    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; array.length; i++) {
        <span class="keyword">var</span> line = <span class="string">''</span>;

        <span class="keyword">if</span> ($(<span class="string">"#quote"</span>).is(<span class="string">':checked'</span>)) {
            <span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> array[i]) {
                <span class="keyword">var</span> value = array[i][index] + <span class="string">""</span>;
                line += <span class="string">'"'</span> + value.replace(<span class="regexp">/"/g</span>, <span class="string">'""'</span>) + <span class="string">'",'</span>;
            }
        } <span class="keyword">else</span> {
            <span class="keyword">for</span> (<span class="keyword">var</span> index <span class="keyword">in</span> array[i]) {
                line += array[i][index] + <span class="string">','</span>;
            }
        }

        line = line.slice(<span class="number">0</span>, -<span class="number">1</span>);
        str += line + changeLine;
    }
    $(target).attr(<span class="string">'href'</span>,<span class="string">"data:text/csv;charset=utf-8,"</span> + str);
    $(target).attr(<span class="string">'download'</span>,fileName);
    <span class="keyword">if</span>(IEV&gt;<span class="number">9</span>){            <span class="comment">//IE10+ 处理方案</span>
        <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([str], {
                <span class="string">"type"</span>: <span class="string">"text/csv;charset=utf-8;"</span>
        });
        navigator.msSaveBlob(blob, fileName);
    }
    <span class="keyword">return</span>;  
} ; 
</code></pre><p>然而，怎么都觉得IE9还是必须对应才行。目前先做到这吧。<br><a href="http://blog.eliacontini.info/post/79860720828/export-to-csv-using-javascript-the-download-attribute" target="_blank">参考链接</a></p>
<p>顺便记录下csv的格式问题。csv在用excel打开时有时会出现乱码。原因在微软对ut8编码时，要求放置bom。（真够扯淡的，不放bom才是标准好不好）<br>为了对应可以在string前加上\ufeff字符。但是奇怪的是，加上后windows上打开没问题，mac上excel却打开乱码了，懒得管了。</p>
]]></content>
    
    
      <category term="javascript" scheme="http://fyg.xyjp.net/about/tags/javascript/"/>
    
      <category term="Develop" scheme="http://fyg.xyjp.net/about/categories/Develop/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[css针对IE浏览器设定]]></title>
    <link href="http://fyg.xyjp.net/about/2014/04/29/css%E9%92%88%E5%AF%B9ie%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BE%E5%AE%9A/"/>
    <id>http://fyg.xyjp.net/about/2014/04/29/css针对ie浏览器设定/</id>
    <published>2014-04-29T14:16:12.000Z</published>
    <updated>2014-06-27T14:22:32.000Z</updated>
    <content type="html"><![CDATA[<p>以前没怎么关心过这个问题。看到一个比较好的解决方案是：先在javascript中判断IE版本，然后将版本信息加入html元素的class中。</p>
<pre><code><span class="function"><span class="keyword">function</span> <span class="title">getIEVersion</span><span class="params">()</span> {</span>
      <span class="keyword">var</span> rv = -<span class="number">1</span>;
      <span class="keyword">if</span> (navigator.appName == <span class="string">'Microsoft Internet Explorer'</span>) {
          <span class="keyword">var</span> ua = navigator.userAgent;
          <span class="keyword">var</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"MSIE ([0-9]{1,}[\.0-9]{0,})"</span>);
          <span class="keyword">if</span> (re.exec(ua) != <span class="literal">null</span>)
          rv = <span class="built_in">parseFloat</span>(<span class="built_in">RegExp</span>.$<span class="number">1</span>);
      }
      <span class="keyword">else</span> <span class="keyword">if</span>(navigator.appName == <span class="string">'Netscape'</span>){
          <span class="keyword">var</span> ua = navigator.userAgent;
          <span class="keyword">var</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"Trident/.*rv:([0-9]{1,}[\.0-9]{0,})"</span>); <span class="comment">//for IE 11</span>
          <span class="keyword">if</span> (re.exec(ua) != <span class="literal">null</span>)
          rv = <span class="built_in">parseFloat</span>(<span class="built_in">RegExp</span>.$<span class="number">1</span>);
      }
      <span class="keyword">return</span> rv;
  }
  IEV = getIEVersion();
  <span class="keyword">if</span>(IEV&gt;=<span class="number">6</span>&amp;&amp;IEV&lt;<span class="number">9</span>){
      window.location.href=<span class="string">"http://no-surport.***.com"</span>; <span class="comment">//IE6~8就不支持了  </span>
  }<span class="keyword">else</span> <span class="keyword">if</span>(IEV&gt;=<span class="number">9</span>){
      document.documentElement.className+=<span class="string">' ie ie'</span>+IEV; <span class="comment">//将ie及版本信息加入html的class中。</span>
  }
</code></pre><p>接着在css里面进行设置：</p>
<pre><code><span class="class">.ie9</span> <span class="class">.fiterMask</span><span class="rules">{
    <span class="rule"><span class="attribute">filter</span>:<span class="value"> progid:DXImageTransform.Microsoft.<span class="function">Blur(PixelRadius=<span class="number">10</span>, MakeShadow=false)</span></span></span>;
<span class="rule">}</span></span>
<span class="class">.ie</span> <span class="class">.loginDiv</span><span class="rules">{
    <span class="rule"><span class="attribute">left</span>:<span class="value"><span class="number">50</span>em</span></span>;
<span class="rule">}</span></span>
</code></pre>]]></content>
    
    
      <category term="CSS" scheme="http://fyg.xyjp.net/about/tags/CSS/"/>
    
      <category term="Develop" scheme="http://fyg.xyjp.net/about/categories/Develop/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Caution provisional headers are shown错误]]></title>
    <link href="http://fyg.xyjp.net/about/2014/04/28/caution-provisional-headers-are-shown%E9%94%99%E8%AF%AF/"/>
    <id>http://fyg.xyjp.net/about/2014/04/28/caution-provisional-headers-are-shown错误/</id>
    <published>2014-04-28T14:12:33.000Z</published>
    <updated>2014-06-27T14:22:00.000Z</updated>
    <content type="html"><![CDATA[<p>后端的REST服务前端无法访问，在本地mac机器上测试一切正常，换在另一个widows机器，从局域网访问就发生错误。<br>看上去似乎请求没有发生。可能是angularjs里$http配置的问题吧，自己在header里面加了一些参数。下面是图片：</p>
<p><img src="http://i1066.photobucket.com/albums/u414/xiazhiyu/30AD30E330D730C130E3_zpsab7aabf8.png" alt="图片"></p>
<p>太累了。暂时不管了。</p>
<p>4-29.更新<br>原因明白了。其实很简单，代码里使用的localhost.<br>而局域网里是通过ip访问的，造成跨域问题。而REST服务默认无法跨域访问，因此出错。</p>
]]></content>
    
    
      <category term="angularjs" scheme="http://fyg.xyjp.net/about/tags/angularjs/"/>
    
      <category term="Develop" scheme="http://fyg.xyjp.net/about/categories/Develop/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[angular里指令（directive）的用法]]></title>
    <link href="http://fyg.xyjp.net/about/2014/04/27/angular%E9%87%8C%E6%8C%87%E4%BB%A4%EF%BC%88directive%EF%BC%89%E7%9A%84%E7%94%A8%E6%B3%95/"/>
    <id>http://fyg.xyjp.net/about/2014/04/27/angular里指令（directive）的用法/</id>
    <published>2014-04-27T13:58:49.000Z</published>
    <updated>2014-06-27T14:11:26.000Z</updated>
    <content type="html"><![CDATA[<p>之前在angular里花了很多时间的，好久没整又给忘记了。<br>做一下记录。<br>主要有两个难点：<br>1.在directive里面使用$http发出请求。<br>2.将directive的scope里面的参数传入外部。即和外部scope通信。<br>代码：</p>
<pre><code>angular.module(<span class="string">'myApp.directives'</span>, []).directive(<span class="string">'listPref'</span>,[<span class="string">'$http'</span>, <span class="function"><span class="keyword">function</span><span class="params">(<span class="variable">$http</span>)</span>{</span>
        <span class="keyword">return</span> {
            restrict : <span class="string">'E'</span>,
            scope: {selectModel: <span class="string">'='</span>},
            template: <span class="string">'&lt;select class="form-control" ng-model="selectModel" ng-options="item.name for item in list"&gt;&lt;/select&gt;'</span>,
            replace : <span class="keyword">true</span>,
            link : <span class="function"><span class="keyword">function</span><span class="params">(scope, elem, attrs)</span>{</span>
                <span class="variable">$http</span>.get(<span class="string">'http://localhost:8080/CSONE_dev/api/pref'</span>).success(<span class="function"><span class="keyword">function</span><span class="params">(list)</span>{</span> 
                  scope.<span class="keyword">list</span>=<span class="keyword">list</span>;
                  scope.selectModel = <span class="keyword">list</span>[<span class="number">12</span>];
                }).error(<span class="function"><span class="keyword">function</span><span class="params">(msg)</span>{</span>
                 console.log(<span class="string">"failed:"</span>+msg);
               });  
            }
        };
}])；
</code></pre>]]></content>
    
    
      <category term="angularjs" scheme="http://fyg.xyjp.net/about/tags/angularjs/"/>
    
      <category term="Develop" scheme="http://fyg.xyjp.net/about/categories/Develop/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[写给曾经的你]]></title>
    <link href="http://fyg.xyjp.net/about/2014/04/24/%E5%86%99%E7%BB%99%E6%9B%BE%E7%BB%8F%E7%9A%84%E4%BD%A0/"/>
    <id>http://fyg.xyjp.net/about/2014/04/24/写给曾经的你/</id>
    <published>2014-04-24T13:52:34.000Z</published>
    <updated>2014-06-27T14:34:00.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>“我们已经找到自己的幸福了。”<br>末后底人这么说，并且眨眼。<br>－－－－尼采</p>
</blockquote>
<p>十年前，当我遇见你时，你已有男朋友。毕业时，我写信告诉你，我喜欢你，可不能因为自己的幸福而毁掉他人的幸福，于是选择放弃。<br>我从未想到过，自己会为此纠葛这么多年，嘴里说放弃，心里却不舍。</p>
<p>一个人到上海时，我在公车上和你打电话。不爱说话的我不知不觉和你聊了一个钟头，直到售票阿姨不耐烦地问我下不下车时，才意识到已经是终点站，车里只剩我一个人。<br>我在电话里告诉你，我觉得自己很无能，没办法给人幸福。－－也许这才是我放弃的真正原因吧。</p>
<p>十年里，经历了太多。我们无意中到了同一个城市，5年里却只见了3次。你问我要找什么样的人。我脱口而出要找一个跟你一样的。<br>－－然而，我们都知道： 有些事，早已经回不去了。</p>
<p>你一直跟着你的男朋友，不离不弃。我很后悔跟你写那封信，说什么‘不能为自己的幸福而毁掉他人的幸福’。其实你应该追寻自己的幸福，即使不跟我在一起。</p>
<p>你和他结了婚。从一家有名的IT公司离职回老家开了个火锅店，当起了老板娘。我知道你过的不容易，可什么也帮不了你。</p>
<p>当我在网上看到你嗮的女儿的照片，我真心地点了赞。我开玩笑问为什么结婚不通知我，怕我来砸场子吗？你只是笑。</p>
<p>我一个人来到了这个陌生的国度。身边的每个人对我都很好，只是依然觉得很寂寞，很多时候一句话也不说。</p>
<p>我小心翼翼地工作，当对面的日本人在玩着line和twitter时，我忙着干不完的活。我知道中国人在他们印象中不是很好，所以他们说公司不招中国人时，我也没问为什么要招我。</p>
<p>直到最近喝酒时，同事对我说，遇见你后，对中国人印象完全改变了。在这个中国人犯罪率居高不下的地方，受到这样的评价让自己都有点措手不及。</p>
<p>然而，这对我而言又有什么意义呢。夜晚回家的电车，永远是那么寂寞。</p>
<p>我多么希望，能和你一起看上野的樱花，台场的夜景，还有京都的红叶…………</p>
<p>再过几天，自己就要满30岁了。30岁还未谈过恋爱的男人终究是不正常吧。</p>
<p>我不是因为你才一直单身的。但如果有时间机器，我想回到十年前，我不会给你写那封信，我只想告诉你，希望你能追寻自己的幸福。…………</p>
]]></content>
    
    
      <category term="情感" scheme="http://fyg.xyjp.net/about/tags/%E6%83%85%E6%84%9F/"/>
    
      <category term="生活" scheme="http://fyg.xyjp.net/about/categories/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[将博客迁移至Github]]></title>
    <link href="http://fyg.xyjp.net/about/2014/03/29/blog-move/"/>
    <id>http://fyg.xyjp.net/about/2014/03/29/blog-move/</id>
    <published>2014-03-29T01:58:33.000Z</published>
    <updated>2014-03-30T10:25:36.000Z</updated>
    <content type="html"><![CDATA[<p>终于决定要使用Github pages了。使用的hexo。<br>做下记录：</p>
<ol>
<li>wordpress 迁移至 hexo 可以使用插件 hexo-migrator-wordpress</li>
<li>有时明明已经安装hexo会出现无法识别hexo命令的问题，往往出在 nodejs 版本原因上，在nvm上指定版本即可</li>
<li>Github上新建Respository时，名称应为:「账户名称.github.io」。自己起初只输入账户名，没有输入后缀，折腾了好久。</li>
</ol>
]]></content>
    
    
      <category term="Github" scheme="http://fyg.xyjp.net/about/tags/Github/"/>
    
      <category term="Develop" scheme="http://fyg.xyjp.net/about/categories/Develop/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[sap 定价技术]]></title>
    <link href="http://fyg.xyjp.net/about/2013/12/26/sap-%E5%AE%9A%E4%BB%B7%E6%8A%80%E6%9C%AF/"/>
    <id>http://fyg.xyjp.net/about/2013/12/26/sap-定价技术/</id>
    <published>2013-12-25T15:32:33.000Z</published>
    <updated>2014-03-30T02:10:06.000Z</updated>
    <content type="html"><![CDATA[<h1 id="SAP定价技术">SAP定价技术</h1>
<p>计算类型：<br>A 百分数：定价值KWERT=条件基值KAWRT×金额%KBETR；<br>B 固定金额：定价值KWERT=金额KBETR；条件基值KAWRT不参与计算；<br>C 数量：定价值KWERT=条件基值KAWRT×金额KBETR；条件基值默认为订单数量；<br>D 毛重量：定价值KWERT=条件基值KAWRT×金额KBETR；条件基值默认为订单毛重；<br>E        净重：定价值KWERT=条件基值KAWRT×金额KBETR；条件基值默认为订单净重；<br>F        体积：定价值KWERT=条件基值KAWRT×金额KBETR；条件基值默认为体积；<br>I 百分数(旅行费用)：定价值KWERT=条件基值KAWRT÷（1－金额%KBETR）×金额%KBETR；<br>H 包括手续费：定价值KWERT=条件基值KAWRT÷（1＋金额%KBETR）×金额%KBETR；<br>G 公式：主要用于自定义定价，金额KBETR一般由手工维护或VK11进行维护，定价值KWERT=条件基值KAWRT×金额KBETR，条件基值KAWRT只能通过例程“基础类型”进行维护；<br>K-U未深入研究，基本上A-G已经够用了，特殊需求可以通过例程进行赋值，后面我会继续介绍定价例程。</p>
]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[SD 相关表]]></title>
    <link href="http://fyg.xyjp.net/about/2013/12/23/sd-%E7%9B%B8%E5%85%B3%E8%A1%A8/"/>
    <id>http://fyg.xyjp.net/about/2013/12/23/sd-相关表/</id>
    <published>2013-12-22T16:44:42.000Z</published>
    <updated>2014-03-30T02:10:42.000Z</updated>
    <content type="html"><![CDATA[<p>KNA1  客户主数据（一般数据层）<br>KNB1  客户主数据（公司代码层）<br>KNMT  Customer-Material Info Record Data Table<br>KNMTK Customer-Material Info Record Header Table<br>KNVA  Customer 主数据 Loading Points<br>KNVD  Customer 主数据 record sales request form<br>KNVI  Customer 主数据 Tax Indicator<br>KNVK  Customer 主数据 Contact Partner<br>KNVL  Customer 主数据 Licenses<br>KNVP  Customer 主数据 Partner Functions<br>KNVS  Customer 主数据 Shipping Data<br>KNVT  Customer 主数据 Record Texts for Sales<br>KNVV  Customer 主数据 Sales Data<br>KONA  Rebate Agreements<br>KOND  Conditions (Data)<br>KONH  Conditions (Header)<br>KONM  Conditions (1 Dimensional Quantity Scales)<br>KONP  Conditions (Item) field LIKP-WADAT_IST - Actual Goods Issue Date - is populated only after Post Goods Issue<br>KONV  Conditions (Procedure Data)<br>KONW  Conditions (1 Dimensional Value Scales)<br>LIKP  SD Document: Delivery Header Data<br>LIPS  SD document: Delivery: Item data<br>LIPSPO  LIPS Reference Data Purchase Order<br>LIPSRF  LIPS Reference Data<br>NACH  Detailed output data<br>NAST  Message status<br>T179  Materials: Product Heirarchies<br>T179T Materials: Product Heirarchies: Texts<br>VAKGU Sales Index: Quotation Validity<br>VAKPA Sales Index: Orders by Partner Function<br>VAPMA Sales Index: Order Items by Material<br>VBAG  Sales Document: Release Data by Schedule Line in Sch.Agrmt.<br>VBAK  销售订单表头-Sales Document: Header Data<br>VBAP  销售订单明细-Sales Document: Item Data<br>VBBE  Sales Requirements: Individual Records<br>VBBS  Sales Requirement Totals Record<br>VBEP  Sales Document: Schedule Line Data<br>VBFA  Sales Document Flow<br>VBFS  Error Log for Collective Processing<br>VBKA  Sales activities<br>VBKD  Sales Document: Business Data<br>VBKOF SD index: Open sales activities by partner function<br>VBKPA SD index: Sales activities by partner function<br>VBLK  SD Document: Delivery Note Header<br>VBLS  Delivery Notes for Collective Processing<br>VBPA  Sales Document: Partner<br>VBRK  销售发票：抬头表Billing: Header Data<br>VBRP  销售发票：行项目表Billing: Item Data<br>VBSK  Collective Processing for a Sales Document Header<br>VBSS  Collective Processing: Sales Documents<br>VBUK  Sales Document: Header Status and Administrative Data<br>VBUP  Sales Document: Item Status<br>VBUV  Sales Document: Incompletion Log<br>VEPVG Delivery Due Index<br>VETVG Delivery Due Index for Stock Transfer<br>VKAOF Sales Index: Open Sales Activities<br>VKDFS SD Index: Billing Initiator<br>VLKPA SD Index: Deliveries by Partner Functions<br>VLPMA SD Index: Delivery Items by Material<br>VRKPA Sales Index: Bills by Partner Functions<br>VRPMA SD Index: Billing Items per Material<br>VTFA  Shipment Document Flow<br>VTRDI Shipment Planning Index</p>
]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[VOFM Routine]]></title>
    <link href="http://fyg.xyjp.net/about/2013/12/22/vofm-routine/"/>
    <id>http://fyg.xyjp.net/about/2013/12/22/vofm-routine/</id>
    <published>2013-12-22T02:06:18.000Z</published>
    <updated>2014-03-30T02:10:56.000Z</updated>
    <content type="html"><![CDATA[<p><a href="http://saptechsolutions.com/pdf/VOFMFormulaRoutines.pdf" target="_blank">http://saptechsolutions.com/pdf/VOFMFormulaRoutines.pdf</a></p>
<p><strong>scale base</strong></p>
<p>A scale base formula can be used to alter the value that the system uses to read the scales in a condition record during pricing. In standard pricing, the system will read the scale in a pricing condition record using the quantity, value, weight, etc. of the document depending on the type of scale that has been defined.</p>
<p><strong>Condition base value </strong></p>
<p>Condition base value formulas can be used to influence the condition basis to which the pricing condition rate will be applied. In standard pricing, the system will apply the condition rate to the quantity in the sales document. For example, the price determined by the system is $45 per case for Product A. 100 cases of Product A have been ordered. The system would then multiply $45 times<br>the number of cases of Product A ordered. Using a condition base value formula, it is possible to alter the condition base, in our example 100, prior to the calculation taking place. A condition base value formula is commonly used to determine the base for distributing header discounts / surcharges to the sales document line items. A condition base value formula is assigned to a condition type in the pricing procedure.</p>
<p><strong>Condition value formulas</strong></p>
<p>Condition value formulas are available to influence the condition value that is displayed for a particular condition type or value line in the pricing procedure. In standard pricing, the system will calculate the condition value by multiplying the condition rate by the quantity. For example, 100 cases times $45 per case equals $4,500. Using a condition value formula, it is possible to alter the<br>condition value, in our example $4,500. Condition value formulas can also be used to compute values that should appear as value lines in the pricing procedure. As an example, standard delivered condition value formulas can be used to compute profit margin and item net value. A condition value formula is assigned to a condition type in the pricing procedure.</p>
]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[关于价格条件中的小计]]></title>
    <link href="http://fyg.xyjp.net/about/2013/12/22/%E5%85%B3%E4%BA%8E%E4%BB%B7%E6%A0%BC%E6%9D%A1%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%B0%8F%E8%AE%A1%20(Libran-Fyg%20%E3%81%AE%E7%AB%B6%E5%90%88%E3%82%B3%E3%83%92%E3%82%9A%E3%83%BC%202014-08-01)/"/>
    <id>http://fyg.xyjp.net/about/2013/12/22/关于价格条件中的小计 (Libran-Fyg の競合コピー 2014-08-01)/</id>
    <published>2013-12-22T01:13:32.000Z</published>
    <updated>2014-03-30T02:11:52.000Z</updated>
    <content type="html"><![CDATA[<p>link : <a href="http://scn.sap.com/thread/1735194" title="scn" target="_blank">http://scn.sap.com/thread/1735194</a></p>
<p>Note 1022966 - FAQ for the ‘Subto’ column (KZWIW) in the pricing procedure</p>
<p>Symptom</p>
<p>Content overview:<br>1. What effect does an entry in the ‘Subto’ column<br>(KZWIW field) have?<br>2. Which settings are possible?<br>3. Which condition/subtotal line is taken into account?<br>4. In which cases is cumulation performed/not performed?<br>5. Which program contains the corresponding logic?<br>6. Are the cumulative values stored in the database?<br>7. Can inactive conditions also be taken into account?<br>8. Examples of how KZWIW is used<br>9. What you can do if the number of freely available subtotal fields in the KOMP (KZWI1 - KZWI6) is insufficient?<br>10. What you can do if the number of internal auxiliary variables<br>(XWORKD -XWORKM) is insufficient?</p>
<p>1. What effect does an entry in the ‘Subto’ column (KZWIW field) have?</p>
<p>You can make certain entries in the ‘Subto’ column (KZWIW field) in the Customizing settings for the pricing procedure. These determine that the condition value or the condition rate of the condition or subtotal line is copied into a certain field of the KOMP structure or into certain internal auxiliary variables (XWORKD - XWORKM). For more details, see Point 2 below.</p>
<p>2. Which settings are possible?</p>
<p>The following options are provided in R/3 standard pricing:</p>
<p>1 Value transfer to KOMP-KZWI1<br>2 Value transfer to KOMP-KZWI2<br>3 Value transfer to KOMP-KZWI3<br>4 Value transfer to KOMP-KZWI4<br>5 Value transfer to KOMP-KZWI5<br>6 Value transfer to KOMP-KZWI6<br>7 Value transfer to KOMP-BONBA (Rebate basis)<br>8 Value transfer to KOMP-PREVA (Preference value)<br>9 Value transfer to KOMP-BRTWR (Gross value)<br>A Price transfer to KOMP-CMPRE (Credit price)<br>B Price transfer to KOMP-WAVWR (Cost)<br>C Value transfer to KOMP-GRWRT (Statistical value)<br>D Value transfer to XWORKD<br>E Value transfer to XWORKE<br>F Value transfer to XWORKF<br>G Value transfer to XWORKG<br>H Value transfer to XWORKH<br>I Value transfer to XWORKI<br>J Value transfer to XWORKJ<br>K Price transfer to XWORKK<br>L Price transfer to XWORKL<br>M Price transfer to XWORKM<br>S Value transfer to KOMP-EFFWR (Effective value)<br>Y Value transfer to KOMP-OIIDC (IS-OIL/only JVA CRP Pricing)<br>Z Value transfer to KOMP-OIEBC (IS-OIL/only JVA CRP Pricing)</p>
<p>The following points apply in this case:<br>Value transfer = transfer of the condition value XKOMV-KWERT<br>Price transfer = transfer of the condition rate XKOMV-KBETR</p>
<p>3. Which condition/subtotal line is taken into account?</p>
<p>A condition is only taken into account if it is not inactive with one of the inactive indicators ‘AKLMXZ’.<br>For the settings ‘B’ (Cost), ‘C’ (Statistical value) and ‘9’ (Gross value), inactive conditions are not taken into account, even with ‘Y’.<br>It is of no consequence whether the condition is statistical or not.<br>Subtotal lines are always taken into account in the standard R/3 system because they never have an inactive indicator in R/3 standard pricing.</p>
<p>4. In which cases is cumulation performed/not performed?</p>
<p>a) With the ‘A’ setting (credit price), only the last line in the pricing result that has the setting ‘A’ and the satisfies the conditions specified in Point 3 below is taken into account (because multiple use of ‘A’ is permitted).<br>The credit price is always determined in the sales unit (VRKME). The condition price unit is always 1 in this case.</p>
<p>Example: If the sales unit is KG, the credit price is determined “per 1 KG”.</p>
<p>b) With all other settings, all lines that satisfy the conditions specified in Point 3 and have the relevant setting are taken into account, that is, the condition values of these lines are cumulated.</p>
<p>Note: With the settings ‘K’ and a ‘L’ (transfer of the condition rate), multiple use (= cumulation) is not useful in most cases.</p>
<p>5. Which program contains the corresponding logic?</p>
<p>The corresponding logic is contained in the SAPLV61A program in the FORM XKOMV_BEWERTEN (Include LV61AA55):</p>
<p>L O O P<br>LOOP AT xkomv.<br>…</p>
<p>calculate subtotals in KOMP<br>IF xkomv-kinak NA ‘AKLMXZ’.<br>…</p>
<p>fill subtotal work fields<br>CASE xkomv-kzwiw. &lt;== The setting for KZWIW<br>WHEN ‘ ‘. is checked in this<br>WHEN ‘A’. CASE statement.<br>…<br>WHEN ‘B’.<br>…<br>WHEN …<br>…<br>ENDCASE.<br>…<br>ENDIF.<br>…</p>
<p>L O O P<br>ENDLOOP.</p>
<p>6. Are the cumulative values stored in the database?</p>
<p>The values, that are included in the fields of the KOMP structure are returned from pricing (program SAPLV61A) to the calling program. The specific application determines whether the values are then stored in a database table with corresponding fields. This is the case in sales (table VBAP) and in the customer invoice (table VBRP), for example.<br>The XWORKD - XWORM fields are auxiliary variables. They are initialized at the start of a pricing evaluation (FORM XKOMV_BEWERTEN, Include LV61AA55) and their contents are lost at the latest on completion of the pricing call (exit of program SAPLV61A).</p>
<p>7. Can inactive conditions also be taken into account?</p>
<p>This is possible if you use a corresponding condition value formula.</p>
<p>Example: You want to cumulate all condition values of a condition ZZZZ in XWORKJ, even if they could be inactive due to a manual entry (KINAK = ‘M’).<br>You must create a condition value formula with the following source code:</p>
<p>if condition is active or inactive with ‘M’<br>IF xkomv-kinak NA ‘AKLXZ’.<br>xworkj = xworkj + xkwert. “cumulate condition value in xworkj<br>ENDIF.</p>
<p>The formula must be assigned to the condition ZZZZ in the pricing procedure.<br>In addition, the ‘J’ setting must be removed from the ‘Subto’ column to prevent the standard R/3 source code for cumulation (see Question 5) from being executed also. This is necessary so that active ZZZZ conditions are not cumulated twice by mistake.</p>
<p>Variant: If the formula contains the following source code, the setting ‘J’ must be retained in the ‘Subto’ column in the pricing procedure:</p>
<p>IF xkomv-kinak = ‘M’. “if condition is inactive with ‘M’<br>xworkj = xworkj + xkwert.”cumulate condition value in xworkj<br>ENDIF.</p>
<p>In this case, the inactive conditions with the setting ‘M’ are cumulated in the formula and the active conditions are cumulated in the R/3 standard source code.</p>
<p>8. Examples of how KZWIW is used:</p>
<p>a) In purchase price calculation schema RM0000, the condition value of the statistical condition EDI1 is copied to XWORKD. For the next condition EDI2, the condition value is calculated with the condition value formula 040 (Include FV64A040) as the difference between XWORKD and the accured net value.</p>
<p>b) A percentage condition ZZ13 refers to three previous conditions ZZ02, ZZ04 and ZZ07, which do not appear in a direct sequence in the pricing procedure. In this case, it is not possible to cumulate the condition values of these three conditions using from-to steps (see Note 834174). However, you can cumulate the condition values of the three conditions ZZ02, ZZ04 and ZZ07 in XWORKL, for example, by setting ‘L’ in the pricing procedure for all three conditions. In addition, you must create a condition base formula for the ZZ13 condition, which copies the content of XWORKL as a condition basis:</p>
<p>use the content of xworkl as condition basis<br>xkwert = xworkl.</p>
<p>9. What you can do if the number of freely available subtotal fields in the KOMP (KZWI1 - KZWI6) is insufficient</p>
<p>An enhancement is possible as part of a modification. For more details, see Note 155012.</p>
<p>Note:<br>With 155012, the imported fields (for example, KOMP-ZZWI11) must be filled in each case using a condition value formula. However, to maintain a corresponding setting for the field name in the ‘Subto’ column of the pricing procedure (‘11’), the modifications in this note are insufficient.<br>Why are further modifications not recommended?</p>
<p>a) Firstly, the value range of the R/3 standard data element KZWIW would have to be extended with the value ‘11’ (transaction SE11). However, the KZWIW data element has only one character. Therefore, the two-digit value ‘11’ is not possible.<br>You can only assign a vaule other than the values listed under Point 2 above (for example, N, O, P).</p>
<p>b) In addition, the source code of the R/3 standard routine FORM XKOMV_BEWERTEN (Include LV61AA55) would have to be modified by including a relevant branch in the CASE statement from Question 5, for example:</p>
<p>WHEN ‘N’. “ modification: ‘N’<br>ADD xkomv-kwert TO komp-zzwi11. “ cumulates in field zzwi11</p>
<p>10. What you can do if the number of internal auxiliary variables (XWORKD -XWORKM) is insufficient</p>
<p>An enhancement is possible as part of a modification. For this purpose, a corresponding data declaration must be made in the LV61ATOP Top Include of the SAPLV61A program, for example:</p>
<p>additional work field for xkomv_bewerten<br>DATA: zwork1 LIKE komv-kwert,</p>
<p>You must then also fill the zwwork1 auxiliary variable using a condition value formula (see Question 9).</p>
<p>Other terms</p>
<p>KZWIW<br>Reason and Prerequisites</p>
<p>These problems are due to the design of R/3 pricing.<br>Solution</p>
<p>This is a consulting note. Other inquiries relating to the functions described above do not fall within the scope of ‘Support’, and are instead processed as part of consulting, which is subject to a separate charge.</p>
]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[关于价格条件中的小计]]></title>
    <link href="http://fyg.xyjp.net/about/2013/12/22/%E5%85%B3%E4%BA%8E%E4%BB%B7%E6%A0%BC%E6%9D%A1%E4%BB%B6%E4%B8%AD%E7%9A%84%E5%B0%8F%E8%AE%A1/"/>
    <id>http://fyg.xyjp.net/about/2013/12/22/关于价格条件中的小计/</id>
    <published>2013-12-22T01:13:32.000Z</published>
    <updated>2014-06-27T14:48:14.000Z</updated>
    <content type="html"><![CDATA[<p>link : <a href="http://scn.sap.com/thread/1735194" title="scn" target="_blank">http://scn.sap.com/thread/1735194</a></p>
<p>Note 1022966 - FAQ for the ‘Subto’ column (KZWIW) in the pricing procedure</p>
<p>Symptom</p>
<p>Content overview:<br>1. What effect does an entry in the ‘Subto’ column<br>(KZWIW field) have?<br>2. Which settings are possible?<br>3. Which condition/subtotal line is taken into account?<br>4. In which cases is cumulation performed/not performed?<br>5. Which program contains the corresponding logic?<br>6. Are the cumulative values stored in the database?<br>7. Can inactive conditions also be taken into account?<br>8. Examples of how KZWIW is used<br>9. What you can do if the number of freely available subtotal fields in the KOMP (KZWI1 - KZWI6) is insufficient?<br>10. What you can do if the number of internal auxiliary variables<br>(XWORKD -XWORKM) is insufficient?</p>
<p>1. What effect does an entry in the ‘Subto’ column (KZWIW field) have?</p>
<p>You can make certain entries in the ‘Subto’ column (KZWIW field) in the Customizing settings for the pricing procedure. These determine that the condition value or the condition rate of the condition or subtotal line is copied into a certain field of the KOMP structure or into certain internal auxiliary variables (XWORKD - XWORKM). For more details, see Point 2 below.</p>
<p>2. Which settings are possible?</p>
<p>The following options are provided in R/3 standard pricing:</p>
<p>1 Value transfer to KOMP-KZWI1<br>2 Value transfer to KOMP-KZWI2<br>3 Value transfer to KOMP-KZWI3<br>4 Value transfer to KOMP-KZWI4<br>5 Value transfer to KOMP-KZWI5<br>6 Value transfer to KOMP-KZWI6<br>7 Value transfer to KOMP-BONBA (Rebate basis)<br>8 Value transfer to KOMP-PREVA (Preference value)<br>9 Value transfer to KOMP-BRTWR (Gross value)<br>A Price transfer to KOMP-CMPRE (Credit price)<br>B Price transfer to KOMP-WAVWR (Cost)<br>C Value transfer to KOMP-GRWRT (Statistical value)<br>D Value transfer to XWORKD<br>E Value transfer to XWORKE<br>F Value transfer to XWORKF<br>G Value transfer to XWORKG<br>H Value transfer to XWORKH<br>I Value transfer to XWORKI<br>J Value transfer to XWORKJ<br>K Price transfer to XWORKK<br>L Price transfer to XWORKL<br>M Price transfer to XWORKM<br>S Value transfer to KOMP-EFFWR (Effective value)<br>Y Value transfer to KOMP-OIIDC (IS-OIL/only JVA CRP Pricing)<br>Z Value transfer to KOMP-OIEBC (IS-OIL/only JVA CRP Pricing)</p>
<p>The following points apply in this case:<br>Value transfer = transfer of the condition value XKOMV-KWERT<br>Price transfer = transfer of the condition rate XKOMV-KBETR</p>
<p>3. Which condition/subtotal line is taken into account?</p>
<p>A condition is only taken into account if it is not inactive with one of the inactive indicators ‘AKLMXZ’.<br>For the settings ‘B’ (Cost), ‘C’ (Statistical value) and ‘9’ (Gross value), inactive conditions are not taken into account, even with ‘Y’.<br>It is of no consequence whether the condition is statistical or not.<br>Subtotal lines are always taken into account in the standard R/3 system because they never have an inactive indicator in R/3 standard pricing.</p>
<p>4. In which cases is cumulation performed/not performed?</p>
<p>a) With the ‘A’ setting (credit price), only the last line in the pricing result that has the setting ‘A’ and the satisfies the conditions specified in Point 3 below is taken into account (because multiple use of ‘A’ is permitted).<br>The credit price is always determined in the sales unit (VRKME). The condition price unit is always 1 in this case.</p>
<p>Example: If the sales unit is KG, the credit price is determined “per 1 KG”.</p>
<p>b) With all other settings, all lines that satisfy the conditions specified in Point 3 and have the relevant setting are taken into account, that is, the condition values of these lines are cumulated.</p>
<p>Note: With the settings ‘K’ and a ‘L’ (transfer of the condition rate), multiple use (= cumulation) is not useful in most cases.</p>
<p>5. Which program contains the corresponding logic?</p>
<p>The corresponding logic is contained in the SAPLV61A program in the FORM XKOMV_BEWERTEN (Include LV61AA55):</p>
<pre><code>L O O P
LOOP AT xkomv.
<span class="keyword">...</span>

calculate subtotals <span class="keyword">in</span> KOMP
IF xkomv-kinak <span class="literal">NA</span> <span class="string">'AKLMXZ'</span>.
<span class="keyword">...</span>

fill subtotal work fields
CASE xkomv-kzwiw. &amp;lt;== The setting <span class="keyword">for</span> KZWIW
WHEN <span class="string">' '</span>. is checked <span class="keyword">in</span> this
WHEN <span class="string">'A'</span>. CASE statement.
<span class="keyword">...</span>
WHEN <span class="string">'B'</span>.
<span class="keyword">...</span>
WHEN <span class="keyword">...</span>
<span class="keyword">...</span>
ENDCASE.
<span class="keyword">...</span>
ENDIF.
<span class="keyword">...</span>

L O O P
ENDLOOP.
</code></pre><p>6. Are the cumulative values stored in the database?</p>
<p>The values, that are included in the fields of the KOMP structure are returned from pricing (program SAPLV61A) to the calling program. The specific application determines whether the values are then stored in a database table with corresponding fields. This is the case in sales (table VBAP) and in the customer invoice (table VBRP), for example.<br>The XWORKD - XWORM fields are auxiliary variables. They are initialized at the start of a pricing evaluation (FORM XKOMV_BEWERTEN, Include LV61AA55) and their contents are lost at the latest on completion of the pricing call (exit of program SAPLV61A).</p>
<p>7. Can inactive conditions also be taken into account?</p>
<p>This is possible if you use a corresponding condition value formula.</p>
<p>Example: You want to cumulate all condition values of a condition ZZZZ in XWORKJ, even if they could be inactive due to a manual entry (KINAK = ‘M’).<br>You must create a condition value formula with the following source code:</p>
<pre><code><span class="keyword">if</span> condition is active <span class="literal">or</span> inactive <span class="keyword">with</span> <span class="string">'M'</span>
<span class="keyword">IF</span> xkomv<span class="attribute">-kinak</span> NA <span class="string">'AKLXZ'</span><span class="built_in">.</span>
xworkj <span class="subst">=</span> xworkj <span class="subst">+</span> xkwert<span class="built_in">.</span> <span class="string">"cumulate condition value in xworkj
ENDIF.</span>
</code></pre><p>The formula must be assigned to the condition ZZZZ in the pricing procedure.<br>In addition, the ‘J’ setting must be removed from the ‘Subto’ column to prevent the standard R/3 source code for cumulation (see Question 5) from being executed also. This is necessary so that active ZZZZ conditions are not cumulated twice by mistake.</p>
<p>Variant: If the formula contains the following source code, the setting ‘J’ must be retained in the ‘Subto’ column in the pricing procedure:</p>
<pre><code><span class="keyword">IF</span> xkomv<span class="attribute">-kinak</span> <span class="subst">=</span> <span class="string">'M'</span><span class="built_in">.</span> <span class="string">"if condition is inactive with 'M'
xworkj = xworkj + xkwert."</span>cumulate condition value <span class="keyword">in</span> xworkj
ENDIF<span class="built_in">.</span>
</code></pre><p>In this case, the inactive conditions with the setting ‘M’ are cumulated in the formula and the active conditions are cumulated in the R/3 standard source code.</p>
<p>8. Examples of how KZWIW is used:</p>
<p>a) In purchase price calculation schema RM0000, the condition value of the statistical condition EDI1 is copied to XWORKD. For the next condition EDI2, the condition value is calculated with the condition value formula 040 (Include FV64A040) as the difference between XWORKD and the accured net value.</p>
<p>b) A percentage condition ZZ13 refers to three previous conditions ZZ02, ZZ04 and ZZ07, which do not appear in a direct sequence in the pricing procedure. In this case, it is not possible to cumulate the condition values of these three conditions using from-to steps (see Note 834174). However, you can cumulate the condition values of the three conditions ZZ02, ZZ04 and ZZ07 in XWORKL, for example, by setting ‘L’ in the pricing procedure for all three conditions. In addition, you must create a condition base formula for the ZZ13 condition, which copies the content of XWORKL as a condition basis:</p>
<p>use the content of xworkl as condition basis<br>xkwert = xworkl.</p>
<p>9. What you can do if the number of freely available subtotal fields in the KOMP (KZWI1 - KZWI6) is insufficient</p>
<p>An enhancement is possible as part of a modification. For more details, see Note 155012.</p>
<p>Note:<br>With 155012, the imported fields (for example, KOMP-ZZWI11) must be filled in each case using a condition value formula. However, to maintain a corresponding setting for the field name in the ‘Subto’ column of the pricing procedure (‘11’), the modifications in this note are insufficient.<br>Why are further modifications not recommended?</p>
<p>a) Firstly, the value range of the R/3 standard data element KZWIW would have to be extended with the value ‘11’ (transaction SE11). However, the KZWIW data element has only one character. Therefore, the two-digit value ‘11’ is not possible.<br>You can only assign a vaule other than the values listed under Point 2 above (for example, N, O, P).</p>
<p>b) In addition, the source code of the R/3 standard routine FORM XKOMV_BEWERTEN (Include LV61AA55) would have to be modified by including a relevant branch in the CASE statement from Question 5, for example:</p>
<p>WHEN ‘N’. “ modification: ‘N’<br>ADD xkomv-kwert TO komp-zzwi11. “ cumulates in field zzwi11</p>
<p>10. What you can do if the number of internal auxiliary variables (XWORKD -XWORKM) is insufficient</p>
<p>An enhancement is possible as part of a modification. For this purpose, a corresponding data declaration must be made in the LV61ATOP Top Include of the SAPLV61A program, for example:</p>
<p>additional work field for xkomv_bewerten<br>DATA: zwork1 LIKE komv-kwert,</p>
<p>You must then also fill the zwwork1 auxiliary variable using a condition value formula (see Question 9).</p>
<p>Other terms</p>
<p>KZWIW<br>Reason and Prerequisites</p>
<p>These problems are due to the design of R/3 pricing.<br>Solution</p>
<p>This is a consulting note. Other inquiries relating to the functions described above do not fall within the scope of ‘Support’, and are instead processed as part of consulting, which is subject to a separate charge.</p>
]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[sap 定价条件]]></title>
    <link href="http://fyg.xyjp.net/about/2013/12/20/sap-%E5%AE%9A%E4%BB%B7%E6%9D%A1%E4%BB%B6/"/>
    <id>http://fyg.xyjp.net/about/2013/12/20/sap-定价条件/</id>
    <published>2013-12-20T12:23:08.000Z</published>
    <updated>2014-03-30T02:12:14.000Z</updated>
    <content type="html"><![CDATA[<p>这里简要解释一下:</p>
<p>Counter：系统用它来显示计算方案中一个阶段内的存取编号。例如，你可以把所有运输附加费分配给步骤100，然而，可能有三个条件类型，每一个代表一个不同的运输附加费，因此你可以把步骤100分配一个运输条件类型，计数1；另一个分配给步骤100，计数2，另一个分配给步骤100，计数3。</p>
<p>小计：是计算求和的字段，这些小计字段可以在订单/开票的用户出口中使用，其中小计1到小计6将更新VBAP和VBRP，以及SIS，所以经常用于各种报表。</p>
<ul>
<li>系统中小计 短文本</li>
<li>没有独立的小计 *</li>
<li>1值转到 KOMP-KZWI1 *</li>
<li>2值转到 KOMP-KZWI2 *</li>
<li>3值转到 KOMP-KZWI3 *</li>
<li>4值转到 KOMP-KZWI4 *</li>
<li>5值转到 KOMP-KZWI5 *</li>
<li>6值转到 KOMP-KZWI6 *</li>
<li>7 值转到KOMP_BONBA(回扣基础1 )</li>
<li>8 依据 KOMP-PREVA（优先值）复制值</li>
<li>9 将值复制到 KOMP-BRTWR( 毛值 )</li>
<li>A 价格转到 KOMP-CMPRE ( 贷方价格 ) *</li>
<li>B 值转到 KOMP-WAVWR（成本）*</li>
<li>C 值转到 KOMP-GKWRT（统计值）</li>
<li>D 将值复制到 XWORKD</li>
<li>E 将值复制到 XWORKE</li>
<li>F 将值复制到 XWORKF</li>
<li>G 将值复制到 XWORKG</li>
<li>H 将值复制到 XWORKH</li>
<li>I Wert黚ernahme nach XWORKI</li>
<li>J 将值复制到 XWORKJ</li>
<li>K 将价格复制到 XWORKK</li>
<li>L 将价格复制到 XWORKL</li>
<li>M 将价格复制到 XWORKM</li>
<li>Q 保留的 (IS-OIL)</li>
<li>S 将值复制到 KOMP-EFFWR (有效值)</li>
<li>Y 保留的 (IS-OIL)</li>
<li>Z 保留的 (IS-OIL)</li>
<li>1-6是把某些小计值存储到sap数据库中的默写位置，没什么特别意思，可以按要求使用。</li>
<li>对于成本和贷方两项。成本会作为物料的成本抛转到copa中，而贷方是作为信用核算的基础。<br>需求：（系统）用于判断是否执行该条件类型（取值）的Routine，在VOFM中可自定义，需要申请</li>
</ul>
<p>Asscess Key。</p>
<p>计算类：用于计算该条件类型的值的Routine，在VOFM中可自定义，需要申请Asscess Key。</p>
<p>条件基：用于计算该条件类型的基值的Routine，在VOFM中可自定义，需要申请Asscess Key。</p>
<p>帐码：又称“记帐码”，用于确定销售收入科目，“状态”字段未勾上的条件类型都必须有记帐码，否</p>
<p>则开票时无法生成会计凭证。</p>
<p>应计项：用于确定返利预提”accruals”科目（的“记帐码”）.</p>
<p><img src="http://erphome.net/wdb/upload/forum5_f_2127.jpg" alt="pic"></p>
]]></content>
    
    
      <category term="sap" scheme="http://fyg.xyjp.net/about/tags/sap/"/>
    
      <category term="SAP" scheme="http://fyg.xyjp.net/about/categories/SAP/"/>
    
  </entry>
  
</feed>
